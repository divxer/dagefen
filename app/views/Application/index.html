#{extends 'main.html' /}
#{set title:'Home' /}

#{set 'moreStyles'}
    #{get 'moreStyles' /}
    <style type="text/css">
        .box {
            margin: 5px;
            padding: 5px;
            font-size: 11px;
            line-height: 1.4em;
            float: left;
            -webkit-border-radius: 5px;
            -moz-border-radius: 5px;
            border-radius: 5px;
        }

        .box h2 {
            font-size: 14px;
            font-weight: 200;
        }

        /* Infinite Scroll loader */
        #infscr-loading {
            text-align: center;
            z-index: 100;
            position: fixed;
            left: 45%;
            bottom: 40px;
            width: 200px;
            padding: 10px;
            background: #000;
            opacity: 0.8;
            color: #FFF;
            -webkit-border-radius: 10px;
            -moz-border-radius: 10px;
            border-radius: 10px;
        }

        .box img,
        #tumblelog img {
            display: block;
            width: 100%;
        }

        /* Subnav */
        .subnav {
            width: 100%;
            height: 36px;
            background-color: #eeeeee; /* Old browsers */
            background-repeat: repeat-x; /* Repeat the gradient */
            background-image: -moz-linear-gradient(top, #f5f5f5 0%, #eeeeee 100%); /* FF3.6+ */
            background-image: -webkit-gradient(linear, left top, left bottom, color-stop(0%,#f5f5f5), color-stop(100%,#eeeeee)); /* Chrome,Safari4+ */
            background-image: -webkit-linear-gradient(top, #f5f5f5 0%,#eeeeee 100%); /* Chrome 10+,Safari 5.1+ */
            background-image: -ms-linear-gradient(top, #f5f5f5 0%,#eeeeee 100%); /* IE10+ */
            background-image: -o-linear-gradient(top, #f5f5f5 0%,#eeeeee 100%); /* Opera 11.10+ */
            filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#f5f5f5', endColorstr='#eeeeee',GradientType=0 ); /* IE6-9 */
            background-image: linear-gradient(top, #f5f5f5 0%,#eeeeee 100%); /* W3C */
            border: 1px solid #e5e5e5;
            -webkit-border-radius: 4px;
            -moz-border-radius: 4px;
            border-radius: 4px;
        }
        .subnav .nav {
            margin-bottom: 0;
        }
        .subnav .nav > li > a {
            margin: 0;
            padding-top:    11px;
            padding-bottom: 11px;
            border-left: 1px solid #f5f5f5;
            border-right: 1px solid #e5e5e5;
            -webkit-border-radius: 0;
            -moz-border-radius: 0;
            border-radius: 0;
        }
        .subnav .nav > .active > a,
        .subnav .nav > .active > a:hover {
            padding-left: 13px;
            color: #777;
            background-color: #e9e9e9;
            border-right-color: #ddd;
            border-left: 0;
            -webkit-box-shadow: inset 0 3px 5px rgba(0,0,0,.05);
            -moz-box-shadow: inset 0 3px 5px rgba(0,0,0,.05);
            box-shadow: inset 0 3px 5px rgba(0,0,0,.05);
        }
        .subnav .nav > .active > a .caret,
        .subnav .nav > .active > a:hover .caret {
            border-top-color: #777;
        }
        .subnav .nav > li:first-child > a,
        .subnav .nav > li:first-child > a:hover {
            border-left: 0;
            padding-left: 12px;
            -webkit-border-radius: 4px 0 0 4px;
            -moz-border-radius: 4px 0 0 4px;
            border-radius: 4px 0 0 4px;
        }
        .subnav .nav > li:last-child > a {
            border-right: 0;
        }
        .subnav .dropdown-menu {
            -webkit-border-radius: 0 0 4px 4px;
            -moz-border-radius: 0 0 4px 4px;
            border-radius: 0 0 4px 4px;
        }

        /* Fixed subnav on scroll, but only for 980px and up (sorry IE!) */
        @media (min-width: 980px) {
            .subnav-fixed {
                position: fixed;
                top: 40px;
                left: 0;
                right: 0;
                z-index: 1020; /* 10 less than .navbar-fixed to prevent any overlap */
                border-color: #d5d5d5;
                border-width: 0 0 1px; /* drop the border on the fixed edges */
                -webkit-border-radius: 0;
                -moz-border-radius: 0;
                border-radius: 0;
                -webkit-box-shadow: inset 0 1px 0 #fff, 0 1px 5px rgba(0,0,0,.1);
                -moz-box-shadow: inset 0 1px 0 #fff, 0 1px 5px rgba(0,0,0,.1);
                box-shadow: inset 0 1px 0 #fff, 0 1px 5px rgba(0,0,0,.1);
                filter: progid:DXImageTransform.Microsoft.gradient(enabled=false); /* IE6-9 */
            }
            .subnav-fixed .nav {
                width: 1170px;
                margin: 0 auto;
                padding: 0 1px;
            }
            .subnav .nav > li:first-child > a,
            .subnav .nav > li:first-child > a:hover {
                -webkit-border-radius: 0;
                -moz-border-radius: 0;
                border-radius: 0;
            }
        }
    </style>
#{/set}

#{set 'moreScripts'}
    #{get 'moreScripts' /}
    <script src="@{'/public/javascripts/jquery.masonry.min.js'}"></script>
    <script src="@{'/public/javascripts/jquery.infinitescroll.min.js'}"></script>
    <script>
        $(function(){

            var $container = $('#album-list');

            $container.imagesLoaded(function(){
                $('#loading').remove();

                $container.masonry({
                    itemSelector: '.box'//,
//                    columnWidth: 100
                });
            });

            $container.infinitescroll({
                        navSelector  : '#page-nav',    // selector for the paged navigation
                        nextSelector : '#page-nav a',  // selector for the NEXT link (to page 2)
                        itemSelector : '.box',     // selector for all items you'll retrieve
                        animate: true,
                        loading: {
                            finishedMsg: '<em>没有了...</em>',
                            img: 'http://i.imgur.com/6RMhx.gif',
                            msgText: "<em>正在加载...</em>"
                        }
                    },
                    // trigger Masonry as a callback
                    function( newElements ) {
                        // hide new items while they are loading
                        var $newElems = $( newElements ).css({ opacity: 0 });
                        // ensure that images load before adding to masonry layout
                        $newElems.imagesLoaded(function(){
                            // show elems now they're ready
                            $newElems.animate({ opacity: 1 });
                            $container.masonry( 'appended', $newElems, true );
                        });
                    }
            );

            // fix sub nav on scroll
            var $win = $(window)
                    , $nav = $('.subnav')
                    , navTop = $('.subnav').length && $('.subnav').offset().top - 40
                    , isFixed = 0

            processScroll();

            $win.on('scroll', processScroll)

            function processScroll() {
                var i, scrollTop = $win.scrollTop()
                if (scrollTop >= navTop && !isFixed) {
                    isFixed = 1
                    $nav.addClass('subnav-fixed')
                } else if (scrollTop <= navTop && isFixed) {
                    isFixed = 0
                    $nav.removeClass('subnav-fixed')
                }
            }
        });
    </script>
#{/set}

<div class="subnav">
    <ul class="nav nav-pills">
        <li class="active">
            <a href="/">
                <i class="icon-bookmark"></i>&nbsp;首页
            </a>
        </li>

        <li>
            <a href=""><i class="icon-list-alt"></i>分类一</a>
        </li>

        <li>
            <a href="">
                <b>分类二</b>
            </a>
        </li>
    </ul>

</div>

<div id="album-list" class="clearfix masonry">
    #{list items:albumList, as:'_album'}
        <div class="box thumbnail span3 masonry-brick">
            <a href="@{Albums.show(_album.id)}" title="${_album.title}" target="_blank">
                <img src="${_album.thumbnail}" alt="${_album.title}">
            </a>
        </div>
    #{/list}
</div>

<nav id="page-nav">
    <a href="@{Application.index(2, flash.searchText)}"></a>
</nav>